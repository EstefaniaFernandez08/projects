SELECT
    SOURCE_SYSTEM,
    COUNT (SOURCE_SYSTEM) AS ROW_COUNT,
    COUNT(DISTINCT SUPPLIER_ERP) AS DISTINCT_ERP,
    COUNT (DISTINCT SUPPLIER_NORMALIZED)AS DISTINCT_NORMALIZED
FROM
    TBC_SPEND_FINAL
WHERE FILE_NAME IN(
    'TBC_NONPO_09012023-09302023_FY23-SEP',
    'TBC_NONPO_08012023-08312023_FY23-AUG',
    'TBC_NONPO_07012023-07312023_FY23-JUL',
    'TBC_GNFRPO_08012023-08312023_FY23-AUG',
    'TBC_GNFRPO_07012023-07312023_FY23-JUL',
    'TBC_GNFRPO_09012023-09302023_FY23-SEP',
    'TBC_CONCUR_FY23-AUG',
    'TBC_CONCUR_FY23-SEP',
    'TBC_CONCUR_FY23-JUL'
)
GROUP BY
    SOURCE_SYSTEM;
    
--Concur/SAP data supplier normalized list in terms of spend

SELECT
    SOURCE_SYSTEM,
    SUPPLIER_NORMALIZED,
    TOTAL_SPEND,
    (TOTAL_SPEND/(SELECT SUM(TOTAL_SPEND_USD) FROM TBC_SPEND_FINAL WHERE  SOURCE_SYSTEM = 'SAP ' ))AS PERCENTAGE,
    ROW_COUNT,
    DISTINCT_ERP_NAMES
   
FROM
(
    SELECT
        SOURCE_SYSTEM,
        SUPPLIER_NORMALIZED,
        SUM(TOTAL_SPEND_USD)AS TOTAL_SPEND,
        COUNT(SOURCE_SYSTEM) AS ROW_COUNT,
        COUNT (DISTINCT SUPPLIER_ERP) DISTINCT_ERP_NAMES
    FROM
        TBC_SPEND_FINAL
    GROUP BY 
        SOURCE_SYSTEM,
        SUPPLIER_NORMALIZED  
)        
WHERE
        SOURCE_SYSTEM = 'SAP'

 ORDER BY TOTAL_SPEND DESC;

    
    

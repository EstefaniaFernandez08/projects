--update the spend table

SELECT
    DIVERSITY_FLAG,
    SD_DIVERSITY_ATTRIBUTES,
    COUNT(DIVERSITY_FLAG) AS ROW_COUNT,
    COUNT(DISTINCT SUPPLIER_NORMALIZED) AS DISTINCT_NORMALIZED,
    SUM(SPEND_USD) AS SPEND_USD
FROM
    DF_SUB_SPEND_FINAL
--WHERE SD_DIVERSITY_ATTRIBUTES = 'SMALL SDB'
GROUP BY
    DIVERSITY_FLAG,
    SD_DIVERSITY_ATTRIBUTES
ORDER BY SD_DIVERSITY_ATTRIBUTES;
    

-- Finally clean whitespaces in both tables
UPDATE DF_SUB_SPEND_FINAL
SET SD_DIVERSITY_ATTRIBUTES = TRIM(SD_DIVERSITY_ATTRIBUTES)
WHERE SD_DIVERSITY_ATTRIBUTES IS NOT NULL;


-- Then update the SUB_SPEND_FINAL table
UPDATE DF_SUB_SPEND_FINAL
SET DIVERSITY_FLAG = 'NO'
WHERE SD_DIVERSITY_ATTRIBUTES IN ('SMALL SDB');

----------------------------------------------------------------------------
--update the diversity table

SELECT
    DIVERSITY_FLAG,
    SD_DIVERSITY_ATTRIBUTES,
    COUNT(DIVERSITY_FLAG) AS ROW_COUNT,
    COUNT(DISTINCT SUPPLIER_NORMALIZED) AS DISTINCT_NORMALIZED
FROM
    DF_SUB_SUP_DIV
--WHERE SD_DIVERSITY_ATTRIBUTES = 'SMALL SDB'
GROUP BY
    DIVERSITY_FLAG,
    SD_DIVERSITY_ATTRIBUTES
ORDER BY SD_DIVERSITY_ATTRIBUTES;


UPDATE DF_SUB_SUP_DIV
SET SD_DIVERSITY_ATTRIBUTES = TRIM(SD_DIVERSITY_ATTRIBUTES)
WHERE SD_DIVERSITY_ATTRIBUTES IS NOT NULL;

-- Start by updating the SUB_SUP_DIV table
UPDATE DF_SUB_SUP_DIV
SET DIVERSITY_FLAG = 'NO'
WHERE SD_DIVERSITY_ATTRIBUTES IN ('SMALL SDB');




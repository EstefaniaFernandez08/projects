UPDATE TBC_SPEND_FINAL 
SET 
    FISCAL_MONTH = 
        CASE 
            WHEN SUBSTR(TRANSACTION_DATE, 4, 3) = 'APR' THEN 'FY_' || SUBSTR(TRANSACTION_DATE, 8, 2) || ' 01-APR'
            WHEN SUBSTR(TRANSACTION_DATE, 4, 3) = 'MAY' THEN 'FY_' || SUBSTR(TRANSACTION_DATE, 8, 2) || ' 02-MAY'
            WHEN SUBSTR(TRANSACTION_DATE, 4, 3) = 'JUN' THEN 'FY_' || SUBSTR(TRANSACTION_DATE, 8, 2) || ' 03-JUN'
            WHEN SUBSTR(TRANSACTION_DATE, 4, 3) = 'JUL' THEN 'FY_' || SUBSTR(TRANSACTION_DATE, 8, 2) || ' 04-JUL'
            WHEN SUBSTR(TRANSACTION_DATE, 4, 3) = 'AUG' THEN 'FY_' || SUBSTR(TRANSACTION_DATE, 8, 2) || ' 05-AUG'
            WHEN SUBSTR(TRANSACTION_DATE, 4, 3) = 'SEP' THEN 'FY_' || SUBSTR(TRANSACTION_DATE, 8, 2) || ' 06-SEP'
            WHEN SUBSTR(TRANSACTION_DATE, 4, 3) = 'OCT' THEN 'FY_' || SUBSTR(TRANSACTION_DATE, 8, 2) || ' 07-OCT'
            WHEN SUBSTR(TRANSACTION_DATE, 4, 3) = 'NOV' THEN 'FY_' || SUBSTR(TRANSACTION_DATE, 8, 2) || ' 08-NOV'
            WHEN SUBSTR(TRANSACTION_DATE, 4, 3) = 'DEC' THEN 'FY_' || SUBSTR(TRANSACTION_DATE, 8, 2) || ' 09-DEC'
            WHEN SUBSTR(TRANSACTION_DATE, 4, 3) = 'JAN' THEN 'FY_' || SUBSTR(TRANSACTION_DATE, 8, 2) || ' 10-JAN'
            WHEN SUBSTR(TRANSACTION_DATE, 4, 3) = 'FEB' THEN 'FY_' || SUBSTR(TRANSACTION_DATE, 8, 2) || ' 11-FEB'
            ELSE 'FY_' || SUBSTR(TRANSACTION_DATE, 8, 2) || ' 12-MAR' -- The ELSE handles 'MAR'
        END,
    FISCAL_QUARTER =
        CASE 
            WHEN SUBSTR(TRANSACTION_DATE, 4, 3) IN ('APR', 'MAY', 'JUN') THEN 'FY' || SUBSTR(TRANSACTION_DATE, 8, 2) || ' Q1'
            WHEN SUBSTR(TRANSACTION_DATE, 4, 3) IN ('JUL', 'AUG', 'SEP') THEN 'FY' || SUBSTR(TRANSACTION_DATE, 8, 2) || ' Q2'
            WHEN SUBSTR(TRANSACTION_DATE, 4, 3) IN ('OCT', 'NOV', 'DEC') THEN 'FY' || SUBSTR(TRANSACTION_DATE, 8, 2) || ' Q3'
            ELSE 'FY' || SUBSTR(TRANSACTION_DATE, 8, 2) || ' Q4' -- The ELSE here handles 'JAN', 'FEB', and 'MAR'
        END,
    FISCAL_YEAR = 
        CASE 
            WHEN SUBSTR(TRANSACTION_DATE, 4, 3) >= 'APR' THEN 'FY_' || TO_CHAR(TO_NUMBER(SUBSTR(TRANSACTION_DATE, 8, 2)) + 2000)
            ELSE 'FY_' || TO_CHAR(TO_NUMBER(SUBSTR(TRANSACTION_DATE, 8, 2)) + 1999)
        END
WHERE FISCAL_YEAR = 'FY_2024';